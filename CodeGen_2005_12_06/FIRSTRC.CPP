//first.cpp
#include "firstrc.h"

//constants
const int DriveMode=0; //1= 1 motor drives each side (2 motors total)
                        //2 = 2 motors drives each side (4 motors total)
const int MaxProgStep = 19; //
const int BackgroundColor = 0;


//match drive motors with pwm values 1 thorugh 16
int g_lMotor1 = 13;   //pwm numbers corresponding to motors
int g_lMotor2 = 14; 
int g_rMotor1 = 15;
int g_rMotor2 = 16;

//default is that a motor goes max fwd at 255                       
int g_lMotor1Fwd = 1; //1 = Max FWD is 255 -1 = Max FWD is 0
int g_lMotor2Fwd = 1;
int g_rMotor1Fwd = 1;
int g_rMotor2Fwd = 1;     

float gfTime = 15.1234f;
AutoCommand ac[20];   //stores 20 programmed commands
float g_maxTime = 15; //auto mode is 15 seconds long
int g_currentStep = 0;  
int g_dataPos = 1;    //1 - 5 is setup, 6 through 25 program
int g_dataPosShift = 1;

using namespace std;

void DrawTitle(void){
  setColor(15,BackgroundColor);  //clears background to dark blue
  system("cls");  
  DrawBoxDouble(1,1,4,80);
  setColor(14,BackgroundColor); //yellow
  posCursor(2, 14);
  cout << "<<< FRC Team 342 Autonomous Code Generator v0.1 >>>";
  setColor(11,BackgroundColor); //cyan
  posCursor(3,20);
  cout << "Written by Chuck Bolin, December 2005";
}

void DrawLabels(void){
  
  setColor(15,BackgroundColor); //border color
  DrawBoxDouble(5,1,45,80);
  setColor(14,BackgroundColor); //label color

  //initial labels
  posCursor(7,5); cout << "Autonomous Max Time (seconds):";
  posCursor(8,5); cout << "Left Motor 1 (pwm 1 - 16):    ";
  posCursor(9,5); cout << "Left Motor 2 (pwm 1 - 16):    ";
  posCursor(10,5); cout << "Right Motor 1 (pwm 1 - 16):   ";
  posCursor(11,5); cout << "Right Motor 2 (pwm 1 - 16):   ";
  
  //program values
  setColor(15,BackgroundColor);
  posCursor(13,10);cout << "Start               Stop";
  posCursor(14,10);cout << "Time      Command   Time      Speed";
  
  for(int i=15;i<35;i++){
    posCursor(i,4); cout << i-14 << ":";  
    
  }
  
}

void DrawValues(void){
  setColor(10,BackgroundColor); cout << fixed; cout << setprecision(2);
  posCursor(7,40); cout << gfTime;
  posCursor(8,40); cout << g_lMotor1;
  posCursor(9,40); cout << g_lMotor2;
  posCursor(10,40); cout << g_rMotor1;
  posCursor(11,40); cout << g_rMotor2;
  
  displayHelp();
  moveCursor();
}

void DrawInstructions(void){
  setColor(15,BackgroundColor); //border color
  DrawBoxDouble(6,50,30,29);
  setColor(14,BackgroundColor); //label color
  posCursor(7,59); cout << "Instructions";
  setColor(15,BackgroundColor);
  posCursor(9,52);cout << "ESC - Quit Program";
  posCursor(10,52);cout << "Up/Down Arrows";
  posCursor(11,55);cout << "Move through setup";
  posCursor(12,55);cout << "auto program.";
  posCursor(14,52);cout << "Left/Right Arrows";
  posCursor(15,55);cout << "Move through each";
  posCursor(16,55);cout << "program step.";
  posCursor(18,52);cout << "PageUp/PageDn";
  posCursor(19,55);cout << "Scrolls through ";
  posCursor(20,55);cout << "acceptable values.";  
}

void PrintToFile(void){
	ofstream SaveFile("autogen.txt");

  SaveFile << "/*************************************************" << endl;
  SaveFile << "** Autnomous code generated by FRC Team 342     **" << endl;
  SaveFile << "** Autonomous Code Generator v0.1, Dec. 2005    **" << endl;	
  SaveFile << "*************************************************/" << endl;
  SaveFile << "void User_Autonomous_Code(void){" << endl;
  SaveFile << "//AutoCodeGen variable declarations" << endl << endl;
  SaveFile << "// Initialize all PWMs and Relays" << endl;
  SaveFile << "  pwm01 = pwm02 = pwm03 = pwm04 = pwm05 = pwm06 = pwm07 = pwm08 = 127;" << endl;
  SaveFile << "  pwm09 = pwm10 = pwm11 = pwm12 = pwm13 = pwm14 = pwm15 = pwm16 = 127;" << endl;
  SaveFile << "  relay1_fwd = relay1_rev = relay2_fwd = relay2_rev = 0;" << endl;
  SaveFile << "  relay3_fwd = relay3_rev = relay4_fwd = relay4_rev = 0;" << endl;
  SaveFile << "  relay5_fwd = relay5_rev = relay6_fwd = relay6_rev = 0;" << endl;
  SaveFile << "  relay7_fwd = relay7_rev = relay8_fwd = relay8_rev = 0;"  << endl;
  SaveFile << "  while (autonomous_mode)   // DO NOT CHANGE! " << endl;
  SaveFile << "  {" << endl;
  SaveFile << "    if (statusflag.NEW_SPI_DATA)      // 26.2ms loop area " << endl;
  SaveFile << "   {" << endl;
  SaveFile << "      Getdata(&rxdata);  // DO NOT DELETE" << endl<<endl;
  SaveFile << "      //Auto Generated code here" << endl << endl;
  SaveFile << "      Putdata(&txdata);  // DO NOT DELETE, or you will get no PWM outputs! " << endl;
  SaveFile << "    }" << endl;
  SaveFile << "  }" << endl;
  SaveFile << "}" << endl;
	SaveFile.close();
}

void PrintTimeDate(void){
  struct tm *newtime;
  time_t aclock;
  time(&aclock );   // Get time in seconds
  newtime = localtime( &aclock );   // Convert time to struct tm form 

  /* Print local time as a string */
  //printf( "Current date and time: %s\n", asctime( newtime ) );
  cout << asctime(newtime);  
  
}

void increaseDataPos(void){
  g_dataPos++;
  g_dataPosShift = 1;
  if (g_dataPos > 25)
    g_dataPos = 1;
  moveCursor();  
}

void decreaseDataPos(void){
  g_dataPos--;
  g_dataPosShift = 1;
  if (g_dataPos < 1)
    g_dataPos = 25;
  moveCursor();  
}  

void shiftDataPosRight(void){
  if(g_dataPos > 5){
    g_dataPosShift++;
    if(g_dataPosShift > 4)
      g_dataPosShift = 1;
    moveCursor();     
  }  
}

void shiftDataPosLeft(void){
  if(g_dataPos > 5){
    g_dataPosShift--;
    if(g_dataPosShift < 1)
      g_dataPosShift = 4;
    moveCursor();     
  }  
}

void moveCursor(void){
  displayHelp();
  if(g_dataPos <6)
    posCursor(6 + g_dataPos, 40);
  else{
    posCursor(9 + g_dataPos, 10 + 10 * (g_dataPosShift - 1));
  }
}

void clearHelp(void){
  setColor(1,1);
  for(int i = 0;i<10;i++){
    for(int j = 0; j < 60; j++){
      posCursor(36 + i, 5 + j);
      cout << " ";
    }   
  }    
  setColor(14,1);  
  DrawBoxDouble(36, 5 , 10, 60);
}

void displayHelp(void){
  clearHelp();
  
  if(g_dataPos == 1){
    posCursor(37, 9); cout << "LENGTH OF AUTONOMOUS MODE" << endl;
    posCursor(39, 9); cout << "The length has been 15 seconds for the autonomous mode.";
    posCursor(40, 9); cout << "15 seconds is the default value. This is usually not";
    posCursor(41, 9); cout << "changed.";
  }
  else if(g_dataPos == 2){
    posCursor(37, 9); cout << "LEFT MOTOR #1 PWM NUMBER" << endl;
    posCursor(39, 9); cout << "Allowable values are 1 through 16. This must be a";
    posCursor(40, 9); cout << "unique number from all other motors.";
    posCursor(41, 9); cout << "";
  }
  else if(g_dataPos == 3){
    posCursor(37, 9); cout << "LEFT MOTOR #2 PWM NUMBER" << endl;
    posCursor(39, 9); cout << "This is not used unless a second motor is used to";
    posCursor(40, 9); cout << "drive the left side of the robot. This value must be";
    posCursor(41, 9); cout << "unique from all other motors.";
  }
  else if(g_dataPos == 4){
    posCursor(37, 9); cout << "RIGHT MOTOR #1 PWM NUMBER" << endl;
    posCursor(39, 9); cout << "Allowable values are 1 through 16. This must be a";
    posCursor(40, 9); cout << "unique number from all other motors.";
    posCursor(41, 9); cout << "";
  }
  else if(g_dataPos == 5){
    posCursor(37, 9); cout << "RIGHT MOTOR #2 PWM NUMBER" << endl;
    posCursor(39, 9); cout << "This is not used unless a second motor is used to";
    posCursor(40, 9); cout << "drive the right side of the robot. This value must be";
    posCursor(41, 9); cout << "unique from all other motors.";
  }
  else{
    if (g_dataPosShift == 1){
      posCursor(37, 9); cout << "STEP START TIME" << endl;
      posCursor(39, 9); cout << "";
      posCursor(40, 9); cout << "";
      posCursor(41, 9); cout << "";
    }
    else if (g_dataPosShift == 2){
      posCursor(37, 9); cout << "STEP COMMAND" << endl;
      posCursor(39, 9); cout << "";
      posCursor(40, 9); cout << "";
      posCursor(41, 9); cout << "";
    }
    else if (g_dataPosShift == 3){
      posCursor(37, 9); cout << "STEP STOP TIME" << endl;
      posCursor(39, 9); cout << "";
      posCursor(40, 9); cout << "";
      posCursor(41, 9); cout << "";
    }
    else if (g_dataPosShift == 4){
      posCursor(37, 9); cout << "STEP SPEED" << endl;
      posCursor(39, 9); cout << "";
      posCursor(40, 9); cout << "";
      posCursor(41, 9); cout << "";
    }
  }
}
